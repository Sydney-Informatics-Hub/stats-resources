<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Power simulation for example 1 | </title>
    
    <base>
    <meta name="description" content="```{r setup, include=FALSE} knitr::opts_chunk$set(echo = TRUE) ``` ### Chicken Welfare - bone density (difference between 2 means) load the required packages ```{r load packages, echo=TRUE, message=FALSE, warning=FALSE} library('paramtest') library('pwr') library('tidyverse')... " >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" value="notranslate">
    <link rel="icon"  type="image/x-icon" href="assets/favicon.ico">

    <!-- FontAwesome (GPL license) -->
   <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- jQuery (MIT license)-->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <!-- jQuery cookie (MIT license)-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <!-- Navgoco (BSD license)-->
    <script type="text/javascript" src="assets/js/jquery.navgoco.min.js"></script>
    <!-- Bootstrap (MIT license)-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Anchor JS (MIT license)-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
        <script>
        $( document ).ready(function() {
            anchors.add('h2,h3,h4,h5');
            $('[data-toggle="tooltip"]').tooltip();
        });
        </script>
    

    <script>
        $( document ).ready(function() {
            $("#docnavsidebar").navgoco({
                caretHtml: '',
                accordion: false,
                openClass: 'open', // open
                save: true,
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 300,
                    easing: 'swing'
                }
            });
            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', true);
            });
        });

    </script>

 <!-- For responsive button to toggle sidebar -->
    <script>
        $(document).ready(function() {
            $('[data-toggle=offcanvas]').click(function() {
                $('.row-offcanvas').toggleClass('active');
            });
        });
    </script>

    <!-- User defined js -->
    <script src="assets/js/user_defined_javascript.js"></script>
    <!--Bootstrap (MIT license) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <!-- Original theme from Bootstrap Bootswatch fork: http://www.codeply.com/go/rV7KhUjwCN (MIT license) -->
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/user_defined_web_styles.css" />
    <style>
        ul#markdown-toc::before  {
        content: "Table of Contents"
         }
    </style>

</head>
<body class="default">
<div class="page-container">


    <!-- Top Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container topnavlinks">
            <div class="navbar-header">
              
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="fa fa-bars fa-2x"></span>
                </button>
                
                
                <button type="button" class="navbar-toggle toggle-sidebar-button"  data-toggle="offcanvas" data-target=".sidebar-nav">
                    <span class="sidebarToggle fa fa-columns fa-2x"></span>
                </button>
                


                  
  <div class="navbar-brand"><a class="noExtIcon" href="index.html"><img class="navbar-logo" src="assets/SIHlogo.png"/></a></div>
  

            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-left">

                    <!-- single item nav items appear here -->

                    
                    
                    
                    

                          <!-- drop-down nav items appear here -->

                    
                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">SIH Website & Training calendar<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                            
                            <li><a href="https://www.sydney.edu.au/research/facilities/sydney-informatics-hub.html" class="noExtIcon">SIH Website</a></li>
                            
                            
                            
                            <li><a href="https://www.sydney.edu.au/research/facilities/sydney-informatics-hub/workshops-and-training/training-calendar.html" class="noExtIcon">Training calendar</a></li>
                            
                            
                        </ul>
                    </li>

                    
                    
                    <li><a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:sih.info@sydney.edu.au?subject=SIH resource page feedback&body=I have some feedback about the Power simulation for example 1 page: ' + window.location.href;"><i class="fa fa-envelope-o topnavfeedback"></i>Feedback</a><li>

                    

                    
                    <li><a target="_blank" href="/assets/files/Example1-simulation.Rmd" class="editButton noExtIcon"><i class="fa fa-github fa-lg"></i> Edit on GitHub</a>
</li>
                    


                </ul>
                

                <ul class="nav navbar-nav navbar-right">
                    <li>

                     <div id="search-topnav-container">
                        <form action="search.html" method="get">
                          <div class="input-group search">
                            <input type="text" id="search-box" name="query" class="form-control" placeholder="Search ...">
                            <div class="input-group-btn">
                              <button class="btn btn-default" type="submit" value="search">
                                <i class="glyphicon glyphicon-search"></i>
                              </button>
                            </div>
                          </div>
                        </form>
                        </div>


                    </li>
                </ul>
                
            </div>

        </div>


        <!-- /.container -->
    </nav>

<div class="container">
        <div class="row row-offcanvas row-offcanvas-left">

            <!-- sidebar -->
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">

                
<div class="mydocsidebar">


<div class="sidebar-inner">


  




    <ul id="docnavsidebar" class="docnav">
    

    </li>
</ul>

<hr class="resourceSeparator"></hr>
<div class="relatedResources"></div>
<ul id="entrypages">
        
    </li>
</ul>
</div>
</div>
<script>$("li.open").parents('li').toggleClass("open");</script>


            </div>

            <!-- main area -->
            <div class="col-xs-12 col-sm-9 main">

                    <div class="subtitle">
                    


<a href="https://sydney-informatics-hub.github.io/stats-resources/" class="noExtIcon productSubtitle">Home</a>&nbsp;&nbsp;>&nbsp;&nbsp;assets&nbsp;&nbsp;>&nbsp;&nbsp;files
    




                      </div>

                      


                    <h1>Power simulation for example 1</h1>

                
                    ```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Chicken Welfare - bone density (difference between 2 means)  

load the required packages

```{r load packages, echo=TRUE, message=FALSE, warning=FALSE}
library('paramtest')
library('pwr')
library('tidyverse')
```

### Create a function to simulate data and perform t-test

the function creates two normally distributed samples of data, namely x1 and x2  
x1 has mean = 0 and SD = 1  
x2 has mean = d and SD = 1  
the function requires you to specify the standardised effect size, d  
and the sample size for each group, N  

```{r t_func, echo=TRUE}
t_func <- function(simNum, N, d) {
  x1 <- rnorm(N, 0, 1)
  x2 <- rnorm(N, d, 1)
  
  t <- t.test(x1, x2, var.equal = TRUE)  # run t-test
  stat <- t$statistic
  p <- t$p.value
  
  return(c(t = stat, p = p, sig = (p < .05)))
  # return a named vector with the results we want to keep
  # value of sig will be TRUE or FALSE based on the p value
}
```

### Specify the values of sample size N (per group) and cohens d for the smallest effect size of interest

We will begin with using values of d and N from the G*Power example  
Sample size N = 64  
cohen's d = 0.5  
number of iterations = 1000  
Use paramtest::run_test() to run our required number of iterations of the function
results go in the object "power_ttest"

```{r power_ttest, echo=TRUE}
power_ttest <-
  run_test(
    t_func,
    n.iter = 1000,
    output = 'data.frame',
    N = 64,
    d = .5
  )
```

### report the proportion of "sig" values that are TRUE

```{r results, echo=TRUE}
results(power_ttest) %>%
  summarise(power = mean(sig))
```

Compare the reported value with the value from G*Power (power = 0.8015)  
Note that it will be slightly different, but accuracy can be improved by increasing the number of iterations.  

### Use paramtest::grid_search() to explore scenarios

give the params argument a list of parameters we want to vary.  
lets try N=50, N=100 and N=150 (per group)

```{r scenario_N, echo=TRUE}
power_ttest_vary <-
  grid_search(
    t_func,
    params = list(N = c(50, 100, 150)),
    n.iter = 1000,
    output = 'data.frame',
    d = .5
  )
results(power_ttest_vary) %>%
  group_by(N.test) %>%
  summarise(power = mean(sig))
```
  
### Scenarios: 2 parameters varying

vary N and Cohen's d  
We will use values to cover the range shown in the G*Power example.  

```{r vary2, echo=TRUE}
power_ttest_vary2 <-
  grid_search(
    t_func,
    params = list(N = c(25, 50, 100, 200), d = c(.33, .5, .67)),
    n.iter = 1000,
    output = 'data.frame'
  )
power <- results(power_ttest_vary2) %>%
  group_by(N.test, d.test) %>%
  summarise(power = mean(sig))
print(power)
```
  
### Plot the power simulation

```{r plot2, echo=TRUE}
ggplot(power, aes(
  x = N.test,
  y = power,
  group = factor(d.test),
  colour = factor(d.test)
)) +
  geom_point() +
  geom_line() +
  ylim(c(0, 1)) +
  xlim(c(0, 200)) +
  labs(x = 'Sample Size', y = 'Power', colour = "Cohen's d") +
  theme_minimal()
```

Compare the plot with the G*Power plot.  They are roughly similar.  

Note: I have set n.iter = 1000 for each simulation to keep the run time very short.  Consider increasing n.iter to improve accuracy of results.

This simulation method can be generalised to a wide variety of statistical models.  Other packages may be preferred for specific situations.  

Reference: https://cran.r-project.org/web/packages/paramtest/vignettes/Simulating-Power.html

                  

                    



            </div>
        </div><!--/.container-->


    </div><!--/.page-container-->
    <!-- * Bootsnipp footer: http://bootsnipp.com/snippets/1KEEq (MIT license) -->

<div class="footertop">
    <div class="container">
        <div class="col-md-6">
            <p></p>
        </div>
        <div class="col-md-6">
            <ul class="bottom_ul">
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-5 col-sm-6 footerleft ">


              
                        <div class="logofooter"> About this Site</div>
                <p class="footer-description">This site is managed by the Statistics Consulting team at the Sydney Informatics Hub. Please get in touch via the feedback button above if you encounter any issues.</p>

            </div>
            <div class="col-md-2 col-sm-6 paddingtop-bottom">
                <h6 class="heading7"></h6>
                <ul class="footer-ul">
                  
                </ul>
            </div>

            <div class="col-md-2 col-sm-6 paddingtop-bottom">
              <h6 class="heading7"></h6>
              <ul class="footer-ul">
                
              </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
              <h6 class="heading7"></h6>
              <ul class="footer-ul">
                
              </ul>
            </div>


        </div>
    </div>
    </div>
</footer>
<!--subfooter start from here -->

<div class="copyright">
    <div class="container">
        <div class="col-md-12">
            <p>Â© 2023 Sydney Informatics Hub</p>
        </div>
    </div>
</div>


    <!-- the google_analytics_id gets auto inserted from the config file -->




</body>

</html>
